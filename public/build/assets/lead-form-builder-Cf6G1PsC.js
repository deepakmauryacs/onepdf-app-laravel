document.addEventListener("DOMContentLoaded",()=>{const b=document.getElementById("field-palette"),m=document.getElementById("builder-canvas"),h=document.getElementById("fields-input");let u=window.existingFields||[];function E(){m.innerHTML="",u.forEach((e,a)=>{const n=document.createElement("div");n.className="mb-3";const s=document.createElement("label");s.textContent=e.label||e.type,n.appendChild(s);let t;e.type==="textarea"?(t=document.createElement("textarea"),t.className="form-control",n.appendChild(t)):e.type==="select"?(t=document.createElement("select"),t.className="form-select",(e.options||[]).forEach(l=>{const o=document.createElement("option");o.value=l,o.textContent=l,t.appendChild(o)}),n.appendChild(t)):e.type==="radio"?(t=document.createElement("div"),(e.options||[]).forEach(l=>{const o=document.createElement("div"),p=document.createElement("input");p.type="radio",p.name=`field_${a}`,p.value=l;const d=document.createElement("span");d.textContent=` ${l}`,o.appendChild(p),o.appendChild(d),t.appendChild(o)}),n.appendChild(t)):e.type==="checkbox"?(t=document.createElement("input"),t.type="checkbox",t.className="form-check-input",n.appendChild(t)):(t=document.createElement("input"),t.type=e.type,t.className="form-control",n.appendChild(t));const c=document.createElement("div");c.className="mt-1";const r=document.createElement("button");r.type="button",r.className="btn btn-sm btn-secondary me-1",r.textContent="Edit",r.addEventListener("click",()=>{const l=prompt("Field label",e.label);if(l!==null&&(e.label=l),["select","radio"].includes(e.type)){const o=(e.options||[]).join(", "),p=prompt("Options (comma separated)",o);p!==null&&(e.options=p.split(",").map(d=>d.trim()).filter(d=>d))}E()}),c.appendChild(r);const i=document.createElement("button");i.type="button",i.className="btn btn-sm btn-danger",i.textContent="Remove",i.addEventListener("click",()=>{u.splice(a,1),E()}),c.appendChild(i),n.appendChild(c),m.appendChild(n)}),h.value=JSON.stringify(u)}E(),b.querySelectorAll(".draggable-field").forEach(e=>{e.addEventListener("dragstart",a=>{a.dataTransfer.setData("type",e.dataset.type)})}),m.addEventListener("dragover",e=>e.preventDefault()),m.addEventListener("drop",e=>{e.preventDefault();const a=e.dataTransfer.getData("type"),n=prompt("Field label",a.charAt(0).toUpperCase()+a.slice(1))||a,s={type:a,label:n};if(["select","radio"].includes(a)){const t=prompt("Options (comma separated)","Option 1, Option 2");s.options=t?t.split(",").map(c=>c.trim()).filter(c=>c):[]}u.push(s),E()})});
